# Educational Content: Prayer Tracking for Women

## Comprehensive Guide to Calculating Missed Prayers for Women

### The Challenge of Accurate Calculation

For Muslim women, calculating missed prayers (Qada) presents unique considerations due to menstrual cycles, during which prayers are not required. This creates a complex calculation that requires both Islamic legal understanding and practical estimation methods.

### Islamic Legal Principle: Ghalabat al-Zann (Preponderant Likelihood)

**Definition**: غلبة الظن (Ghalabat al-Zann) is an Islamic legal principle that allows reliance on the most probable estimate when exact verification is impossible.

**Application for Women**: When a woman cannot recall her exact menstruation days over months or years, Islamic law permits her to:
1. Make a reasonable estimate based on her typical cycle
2. Apply this estimate consistently 
3. Consider this estimate as binding once established
4. Not continuously second-guess or revise the calculation

### Scholarly Basis

**Imam al-Nawawi** states: *"When certainty is impossible, one acts upon the preponderant assumption (ghalabat al-zann), and this assumption takes the ruling of certainty."*

**The Maliki School** emphasizes: *"A woman should estimate her menstrual days based on her usual pattern, and once this estimate is made with due consideration, it becomes her basis for calculation."*

**Darul Iftaa** explains: *"If a woman cannot remember the exact days of her menstruation over a long period, she should estimate based on her usual habit. For example, if her usual cycle is 6 days per month, she should calculate based on this and not worry about minor variations."*

### Practical Calculation Methods

#### Method 1: Average Cycle Deduction
- Determine your average menstrual cycle length (typically 5-7 days)
- Calculate total days in the missed period
- Subtract menstrual days: `(Total Days ÷ 30) × Average Cycle Length`
- Apply this to get prayer-required days

**Example**: 
- Missed period: 1 year (365 days)
- Average cycle: 6 days per month
- Calculation: 365 - (12 × 6) = 365 - 72 = 293 prayer days
- Total prayers: 293 × 5 = 1,465 prayers

#### Method 2: Conservative Estimation
- Use the shorter end of your typical cycle range
- This ensures you don't under-calculate your obligations
- Better to pray extra than to fall short

**Example**:
- If your cycle varies between 5-7 days, use 5 days for calculation
- This provides a buffer and ensures you fulfill your obligations

#### Method 3: Monthly Pattern Application
- If you remember your general pattern (e.g., "usually 6 days per month")
- Apply this consistently across all months in the calculation period
- Document your reasoning for future reference

### Detailed Calculation Examples

#### Scenario 1: Two Years of Missed Prayers
**Situation**: Woman missed prayers for 2 years (730 days), average cycle is 6 days per month

**Calculation**:
- Total months: 24 months
- Menstrual days: 24 × 6 = 144 days
- Prayer-required days: 730 - 144 = 586 days
- Total prayers owed: 586 × 5 = 2,930 prayers

#### Scenario 2: Irregular Cycles
**Situation**: Woman with irregular cycles (4-8 days) missed prayers for 18 months

**Conservative Approach**:
- Use minimum cycle length: 4 days
- Total months: 18 months
- Menstrual days: 18 × 4 = 72 days
- Total days: 18 × 30 = 540 days
- Prayer days: 540 - 72 = 468 days
- Total prayers: 468 × 5 = 2,340 prayers

#### Scenario 3: Including Pregnancy
**Situation**: Woman missed prayers for 3 years, including 9 months of pregnancy

**Calculation**:
- Total period: 36 months
- Pregnancy months: 9 months (regular menstrual cycle doesn't apply)
- Non-pregnancy months: 27 months
- Menstrual days (non-pregnancy): 27 × 6 = 162 days
- Pregnancy days: 9 × 30 = 270 days
- Total days: 36 × 30 = 1,080 days
- Prayer days: 1,080 - 162 - 270 = 648 days
- Total prayers: 648 × 5 = 3,240 prayers

### Important Considerations

#### Pregnancy and Postpartum (Nifas)
- **Pregnancy**: No prayers required during menstruation, but regular prayers continue otherwise
- **Postpartum bleeding (Nifas)**: Typically 40 days maximum, no prayers required
- These periods should also be deducted from calculations

**Nifas Calculation Example**:
- Standard postpartum period: 40 days
- If you had 2 children during missed prayer period: 80 days total
- Deduct these days from your total calculation

#### Irregular Cycles
- For women with irregular cycles, use the average over a known period
- If completely irregular, consult with a knowledgeable Islamic scholar
- Document your estimation method for consistency

**Documentation Example**:
"My cycles typically varied between 5-8 days. I used 6 days as my average for calculation purposes, based on my best recollection of the pattern during 2018-2020."

#### Age-Related Changes
- Menstrual patterns change with age
- Use the pattern that was typical during the missed prayer period
- Don't apply current cycle length to past periods if significantly different

### Step-by-Step Calculation Guide

#### For Date Range Method:
1. **Determine total days**: End date - Start date + 1
2. **Calculate months**: Total days ÷ 30 (approximate)
3. **Estimate menstrual days**: Months × Average cycle length
4. **Calculate prayer days**: Total days - Menstrual days
5. **Calculate total prayers**: Prayer days × 5

#### For Bulk Years/Months Method:
1. **Convert to months**: (Years × 12) + Additional months
2. **Estimate total days**: Months × 30.44 (average days per month)
3. **Calculate menstrual days**: Months × Average cycle length
4. **Calculate prayer days**: Total days - Menstrual days
5. **Calculate total prayers**: Prayer days × 5

### Special Circumstances

#### Breastfeeding and Amenorrhea
- Some women don't menstruate while breastfeeding
- If you didn't menstruate during a period, don't deduct cycle days
- Only deduct for actual menstrual periods

#### Medical Conditions
- Conditions like PCOS can affect cycle regularity
- Use your actual experience during the missed prayer period
- When in doubt, consult both medical and Islamic guidance

#### Travel and Stress
- Travel and stress can affect cycles
- Use your typical pattern, not exceptional circumstances
- Focus on your general habit over the missed period

### Spiritual Perspective

The goal is not mathematical perfection but sincere effort to fulfill religious obligations. Islam recognizes human limitations and provides practical solutions through principles like Ghalabat al-Zann.

**Key Reminders**:
- Once you've made a thoughtful, reasonable estimate, trust in Allah's mercy
- Begin your Qada prayers without excessive delay
- Excessive doubt and recalculation can become a barrier to spiritual progress
- Allah knows your sincere intention and effort

### Common Questions and Answers

**Q: What if I'm not sure about my cycle length?**
A: Use 6 days as a conservative estimate. This is within the typical range and ensures you don't under-calculate.

**Q: Should I account for lighter days at the beginning/end of my cycle?**
A: Count all days when you couldn't pray, regardless of flow intensity.

**Q: What if my cycle changed significantly during the missed period?**
A: Try to remember the pattern for different time periods and adjust accordingly, or use an average across the entire period.

**Q: Can I round numbers for easier calculation?**
A: Yes, reasonable rounding is acceptable. The principle of Ghalabat al-Zann allows for practical approximation.

**Q: What if I realize my estimate was wrong after starting Qada prayers?**
A: If you discover a significant error, you can adjust your remaining count. Minor variations don't require recalculation.

### Recommended Approach

1. **Gather Information**: Collect what you remember about your cycles during the missed period
2. **Make Conservative Estimate**: When in doubt, choose the approach that results in more prayers rather than fewer
3. **Document Your Method**: Write down how you calculated for future reference
4. **Begin Prayers**: Start your Qada prayers without excessive delay
5. **Trust the Process**: Have confidence in your sincere effort and Allah's mercy

### Resources for Further Learning

- **Scholarly Sources**: Consult local Islamic scholars for personalized guidance
- **Medical Records**: Check if you have any medical records that might help with cycle estimation
- **Islamic Legal Texts**: Study classical texts on women's prayer obligations
- **Community Support**: Connect with other Muslim women who have gone through similar calculations

---

# User Stories: Female-Specific Prayer Calculation

## Epic: Accurate Prayer Calculation for Women
**As a** female user of the Qada Prayer Companion  
**I want** the app to account for my menstrual cycle when calculating missed prayers  
**So that** I have an accurate count of prayers I actually need to make up

---

## Story 1: Menstrual Cycle Input During Date Range Selection

**As a** female user selecting a date range for missed prayers  
**I want to** input my average menstrual cycle length  
**So that** the app can automatically deduct non-prayer days from my total

### Acceptance Criteria
- When user selects "Female" gender AND "Date Range" input method
- System displays additional input field for menstrual cycle length
- Field accepts values between 1-15 days with default of 6 days
- Field includes helpful explanation text
- Calculation automatically adjusts based on this input
- User can modify the value and see real-time calculation updates
- Validation prevents unrealistic values
- Help tooltip explains typical cycle ranges

### UI Requirements
```
┌─────────────────────────────────────┐
│ Select Date Range                   │
├─────────────────────────────────────┤
│ Start Date: [Date Picker]           │
│ End Date:   [Date Picker]           │
│                                     │
│ ┌─────────────────────────────────┐ │
│ │ 🩸 Menstrual Cycle Information  │ │
│ │                                 │ │
│ │ Average cycle length: [6] days  │ │
│ │                                 │ │
│ │ ℹ️ This helps us calculate your │ │
│ │ Qada prayers more accurately by │ │
│ │ excluding days when prayers are │ │
│ │ not required.                   │ │
│ └─────────────────────────────────┘ │
│                                     │
│ Estimated prayer days: 324 days     │
│ (Total: 365 days - 41 cycle days)   │
└─────────────────────────────────────┘
```

### Technical Logic
```typescript
function calculatePrayerDaysForWomen(
  startDate: Date,
  endDate: Date,
  averageCycleLength: number
): PrayerCalculationResult {
  // Calculate total days in the range
  const totalDays = Math.ceil(
    (endDate.getTime() - startDate.getTime()) / (1000 * 60 * 60 * 24)
  ) + 1;
  
  // Approximate number of months
  const approximateMonths = totalDays / 30.44; // More accurate average
  
  // Calculate total menstrual days
  const totalMenstrualDays = Math.floor(approximateMonths * averageCycleLength);
  
  // Calculate prayer-required days
  const prayerRequiredDays = Math.max(0, totalDays - totalMenstrualDays);
  
  return {
    totalDays,
    menstrualDays: totalMenstrualDays,
    prayerRequiredDays,
    totalPrayers: prayerRequiredDays * 5,
    breakdown: {
      fajr: prayerRequiredDays,
      dhuhr: prayerRequiredDays,
      asr: prayerRequiredDays,
      maghrib: prayerRequiredDays,
      isha: prayerRequiredDays
    }
  };
}
```

### Validation Rules
- Cycle length must be between 1-15 days
- Start date must be before end date
- Date range cannot be in the future
- Maximum date range of 50 years (reasonable limit)

---

## Story 2: Bulk Years/Months Input with Cycle Deduction

**As a** female user who wants to input missed prayers in bulk (years/months)  
**I want to** specify my menstrual cycle length for automatic deduction  
**So that** I don't have to manually calculate the complex math

### Acceptance Criteria
- New input method option: "Bulk Time Period" 
- User can input years and months separately
- Menstrual cycle input appears for female users
- Real-time calculation shows:
  - Total days in period
  - Estimated menstrual days
  - Net prayer-required days
  - Total prayers owed (days × 5)
- Clear breakdown of calculation shown to user
- Option to toggle menstrual cycle deduction on/off

### UI Requirements
```
┌─────────────────────────────────────┐
│ Enter Bulk Time Period              │
├─────────────────────────────────────┤
│ Years:  [2] years                   │
│ Months: [3] months                  │
│                                     │
│ ┌─────────────────────────────────┐ │
│ │ 🩸 Menstrual Cycle Adjustment   │ │
│ │                                 │ │
│ │ Average cycle: [6] days/month   │ │
│ │                                 │ │
│ │ ☑️ Deduct menstrual days        │ │
│ │   from calculation              │ │
│ │                                 │ │
│ │ ❓ Need help? Typical cycles    │ │
│ │   range from 3-10 days          │ │
│ └─────────────────────────────────┘ │
│                                     │
│ ┌─────────────────────────────────┐ │
│ │ 📊 Calculation Breakdown        │ │
│ │                                 │ │
│ │ Total period: 27 months         │ │
│ │ Total days: ~821 days           │ │
│ │ Menstrual days: ~162 days       │ │
│ │ Prayer days: ~659 days          │ │
│ │ Total prayers: ~3,295 prayers   │ │
│ │                                 │ │
│ │ Per prayer type: ~659 each      │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

### Technical Logic
```typescript
interface BulkPeriodInput {
  years: number;
  months: number;
  averageCycleLength: number;
  deductMenstrualDays: boolean;
}

interface PrayerCalculationResult {
  totalDays: number;
  menstrualDays: number;
  prayerRequiredDays: number;
  totalPrayers: number;
  breakdown: {
    fajr: number;
    dhuhr: number;
    asr: number;
    maghrib: number;
    isha: number;
  };
}

function calculateBulkPrayersForWomen(
  input: BulkPeriodInput
): PrayerCalculationResult {
  // Convert everything to months
  const totalMonths = (input.years * 12) + input.months;
  
  // Calculate approximate days (more accurate than 30 days/month)
  const approximateDays = Math.floor(totalMonths * 30.44);
  
  let prayerRequiredDays = approximateDays;
  let menstrualDays = 0;
  
  if (input.deductMenstrualDays) {
    menstrualDays = Math.floor(totalMonths * input.averageCycleLength);
    prayerRequiredDays = Math.max(0, approximateDays - menstrualDays);
  }
  
  const totalPrayers = prayerRequiredDays * 5;
  
  return {
    totalDays: approximateDays,
    menstrualDays,
    prayerRequiredDays,
    totalPrayers,
    breakdown: {
      fajr: prayerRequiredDays,
      dhuhr: prayerRequiredDays,
      asr: prayerRequiredDays,
      maghrib: prayerRequiredDays,
      isha: prayerRequiredDays
    }
  };
}
```

### Validation Rules
- Years: 0-50 (reasonable maximum)
- Months: 0-11 (additional months beyond years)
- Total period must be at least 1 month
- Cycle length: 1-15 days
- At least one of years or months must be > 0

---

## Story 3: Cycle Length Guidance and Validation

**As a** female user inputting my menstrual cycle information  
**I want** guidance on what constitutes a typical cycle length  
**So that** I can provide accurate information for calculation

### Acceptance Criteria
- Help text explains typical cycle ranges (3-10 days)
- Validation prevents unrealistic values (< 1 or > 15 days)
- Tooltip or expandable help section with guidance
- Option to indicate "irregular cycles" with special handling
- Conservative estimation option for uncertain users
- Link to educational content about estimation principles

### UI Requirements
```
┌─────────────────────────────────────┐
│ Menstrual Cycle Information         │
├─────────────────────────────────────┤
│ Average cycle length: [6] days      │
│ [Slider: 1 ----●---- 15]           │
│                                     │
│ ❓ Need help determining this?      │
│ ┌─────────────────────────────────┐ │
│ │ 📋 Typical Ranges:              │ │
│ │ • Light flow: 3-4 days          │ │
│ │ • Average flow: 5-7 days        │ │
│ │ • Heavy flow: 7-10 days         │ │
│ │                                 │ │
│ │ 🤔 Not sure? Use 6 days as a    │ │
│ │ conservative estimate.          │ │
│ │                                 │ │
│ │ ⚠️ Very irregular cycles?       │ │
│ │ Consider consulting a scholar   │ │
│ │ for personalized guidance.      │ │
│ │                                 │ │
│ │ 📚 Learn about Islamic basis    │ │
│ │ for estimation principles       │ │
│ └─────────────────────────────────┘ │
│                                     │
│ Cycle regularity:                   │
│ ● My cycles are fairly regular      │
│ ○ My cycles are irregular           │
│ ○ I'm not sure                      │
│                                     │
│ [Continue] [Learn More]             │
└─────────────────────────────────────┘
```

### Interactive Elements
- **Slider Input**: Visual slider for cycle length with immediate feedback
- **Expandable Help**: Collapsible section with detailed guidance
- **Regularity Options**: Radio buttons for cycle regularity assessment
- **Educational Link**: Direct link to relevant educational content
- **Real-time Preview**: Show calculation preview as user adjusts values

---

## Story 4: Pregnancy and Postpartum Considerations

**As a** female user who was pregnant or had postpartum bleeding during my missed prayer period  
**I want** to account for these special circumstances  
**So that** my calculation is as accurate as possible

### Acceptance Criteria
- Additional option to specify pregnancy periods within date range
- Postpartum (Nifas) period input (up to 40 days per occurrence)
- Clear explanation of how these affect prayer obligations
- Separate calculation for these special circumstances
- Option to add multiple pregnancy/postpartum periods
- Validation to prevent overlapping periods
- Educational content about pregnancy and prayer obligations

### UI Requirements
```
┌─────────────────────────────────────┐
│ Special Circumstances               │
├─────────────────────────────────────┤
│ Did you experience any of these     │
│ during your missed prayer period?   │
│                                     │
│ ☐ Pregnancy periods                 │
│ ☐ Postpartum bleeding (Nifas)      │
│ ☐ Extended illness/medical condition│
│                                     │
│ [Pregnancy Section - if selected]   │
│ ┌─────────────────────────────────┐ │
│ │ 🤱 Pregnancy Period 1           │ │
│ │ Start: [Date Picker]            │ │
│ │ End: [Date Picker]              │ │
│ │ [Remove] [+ Add Another]        │ │
│ └─────────────────────────────────┘ │
│                                     │
│ [Postpartum Section - if selected]  │
│ ┌─────────────────────────────────┐ │
│ │ 🍼 Postpartum Period 1          │ │
│ │ Start Date: [Date Picker]       │ │
│ │ Duration: [40] days (max 40)    │ │
│ │ [Remove] [+ Add Another]        │ │
│ └─────────────────────────────────┘ │
│                                     │
│ ℹ️ These periods will be excluded   │
│ from your prayer calculation        │
│                                     │
│ 📚 Learn about pregnancy & prayers  │
└─────────────────────────────────────┘
```

### Technical Logic
```typescript
interface SpecialPeriod {
  id: string;
  type: 'pregnancy' | 'postpartum' | 'medical';
  startDate: Date;
  endDate?: Date;
  duration?: number; // for postpartum, in days
}

function calculateWithSpecialPeriods(
  totalDays: number,
  menstrualDays: number,
  specialPeriods: SpecialPeriod[]
): PrayerCalculationResult {
  let specialPeriodDays = 0;
  
  specialPeriods.forEach(period => {
    if (period.type === 'pregnancy' && period.endDate) {
      const pregnancyDays = Math.ceil(
        (period.endDate.getTime() - period.startDate.getTime()) / (1000 * 60 * 60 * 24)
      ) + 1;
      specialPeriodDays += pregnancyDays;
    } else if (period.type === 'postpartum' && period.duration) {
      specialPeriodDays += Math.min(period.duration, 40); // Max 40 days
    }
  });
  
  // Adjust menstrual days calculation for periods without regular cycles
  const adjustedMenstrualDays = Math.max(0, menstrualDays - (specialPeriodDays * 0.2)); // Rough adjustment
  
  const prayerRequiredDays = Math.max(0, totalDays - adjustedMenstrualDays - specialPeriodDays);
  
  return {
    totalDays,
    menstrualDays: Math.floor(adjustedMenstrualDays),
    specialPeriodDays,
    prayerRequiredDays,
    totalPrayers: prayerRequiredDays * 5,
    breakdown: {
      fajr: prayerRequiredDays,
      dhuhr: prayerRequiredDays,
      asr: prayerRequiredDays,
      maghrib: prayerRequiredDays,
      isha: prayerRequiredDays
    }
  };
}
```

---

## Story 5: Educational Integration and Confidence Building

**As a** female user learning about prayer calculations  
**I want** to understand the Islamic basis for menstrual cycle considerations  
**So that** I feel confident in the calculation method and can proceed with peace of mind

### Acceptance Criteria
- Integrated educational content about Ghalabat al-Zann principle
- Clear explanation of why menstrual days are excluded from calculations
- Scholarly references supporting the estimation methodology
- Reassurance about the validity and acceptability of reasonable estimation
- Emphasis on sincere effort over mathematical perfection
- Option to save calculation method for future reference

### UI Integration
```
┌─────────────────────────────────────┐
│ 📚 Understanding Your Calculation   │
├─────────────────────────────────────┤
│ Your calculation is based on the    │
│ Islamic principle of Ghalabat       │
│ al-Zann (غلبة الظن) - preponderant  │
│ likelihood.                         │
│                                     │
│ Key Points:                         │
│ • Estimation is Islamically valid   │
│ • Scholars support this approach    │
│ • Sincere effort matters most       │
│ • Perfect precision isn't required  │
│                                     │
│ 📖 [Read Full Article]              │
│ 🎓 [Scholarly References]           │
│                                     │
│ ┌─────────────────────────────────┐ │
│ │ 💡 Your Calculation Summary     │ │
│ │                                 │ │
│ │ Method: Date Range with Cycle   │ │
│ │ Period: Jan 2020 - Dec 2022     │ │
│ │ Cycle Length: 6 days/month      │ │
│ │ Total Prayers: 2,847            │ │
│ │                                 │ │
│ │ ✅ This calculation follows     │ │
│ │ established Islamic principles  │ │
│ │                                 │ │
│ │ [Save Summary] [Email to Self]  │ │
│ └─────────────────────────────────┘ │
│                                     │
│ 🤲 Remember: Allah knows your       │
│ sincere intention and effort        │
└─────────────────────────────────────┘
```

### Educational Content Integration
- **Contextual Help**: Educational snippets throughout the calculation process
- **Scholarly Quotes**: Relevant quotes from Islamic scholars at key decision points
- **Principle Explanations**: Clear explanations of Islamic legal principles being applied
- **Confidence Builders**: Reassuring messages about the validity of the approach
- **Documentation**: Option to save and reference the calculation methodology used

---

## Technical Implementation Requirements

### Data Structure
```typescript
interface FemaleUserData extends OnboardingData {
  menstrualCycle: {
    averageLength: number; // days per month
    isRegular: boolean;
    confidenceLevel: 'certain' | 'fairly-sure' | 'estimated';
  };
  specialPeriods?: {
    pregnancies: Array<{
      id: string;
      startDate: string;
      endDate: string;
    }>;
    postpartum: Array<{
      id: string;
      startDate: string;
      duration: number; // max 40 days
    }>;
    medical: Array<{
      id: string;
      startDate: string;
      endDate: string;
      description?: string;
    }>;
  };
  calculationMethod: {
    type: 'date-range' | 'bulk-period';
    parameters: any;
    timestamp: string;
    notes?: string;
  };
}
```

### Validation System
```typescript
interface ValidationRule {
  field: string;
  rule: (value: any) => boolean;
  message: string;
}

const femaleCalculationValidation: ValidationRule[] = [
  {
    field: 'menstrualCycle.averageLength',
    rule: (value: number) => value >= 1 && value <= 15,
    message: 'Cycle length must be between 1 and 15 days'
  },
  {
    field: 'dateRange',
    rule: (range: {start: string, end: string}) => {
      const start = new Date(range.start);
      const end = new Date(range.end);
      return start < end && end <= new Date();
    },
    message: 'End date must be after start date and not in the future'
  },
  {
    field: 'specialPeriods.postpartum',
    rule: (periods: Array<{duration: number}>) => 
      periods.every(p => p.duration <= 40),
    message: 'Postpartum period cannot exceed 40 days'
  }
];
```

### Error Handling
- **Input Validation**: Real-time validation with helpful error messages
- **Calculation Errors**: Graceful handling of edge cases (negative results, etc.)
- **Data Persistence**: Automatic saving of progress through calculation steps
- **Recovery**: Ability to resume calculation if interrupted
- **Fallback Options**: Alternative calculation methods if primary method fails

### Accessibility Features
- **Screen Reader Support**: Proper ARIA labels for all form elements
- **Keyboard Navigation**: Full keyboard accessibility for all interactive elements
- **High Contrast**: Ensure sufficient color contrast for all text and UI elements
- **Text Scaling**: Support for increased text sizes
- **Clear Language**: Simple, clear language avoiding complex terminology

This comprehensive approach ensures that female users can accurately and confidently calculate their Qada prayers while understanding the Islamic principles that support their methodology.